{% extends 'core/base.html' %}
{% load static %}

{% block content %}
    <div id="boot-screen">
        <div class="loader-text" id="loader-text">INITIALIZING GLOBAL UPLINK...</div>
        <div class="progress-bar-container">
            <div class="progress-bar-fill" id="progress-fill"></div>
        </div>
        <div class="hex-stream" id="hex-stream">0x4F 0xA2 ...</div>
    </div>

    <div id="main-interface">
        <div class="container">
            
            <div class="profile-header">
                <img src="{% static 'core/img/logo.jpg' %}" alt="Jay's Network" class="main-logo">
                <h1>Jay's-Networks</h1>
                <div class="role">FULL STACK PROGRAMMER & SOFTWARE ENGINEER</div>
                <div style="color: #00ff88; font-size: 0.8rem; font-family: 'Orbitron'; margin-top: 10px;">‚óè SYSTEMS ONLINE</div>
            </div>

            <div class="security-monitor">
                <div class="security-header">
                    <span><i class="fas fa-satellite-dish blink"></i> LIVE_THREAT_FEED</span>
                    <span style="font-size: 0.7rem;">STATUS: <span style="color: #33ff00;">ACTIVE_DEFENSE</span></span>
                </div>
                
                <div id="attack-list">
                    <p style="color: #555; padding: 10px;">>> ESTABLISHING SECURE UPLINK...</p>
                </div>
            </div>

            <div class="browser-card scroll-hidden" id="browser-window">
                <div class="browser-header">
                    <div class="window-controls"><div class="dot red"></div><div class="dot yellow"></div><div class="dot green"></div></div>
                    <div class="url-bar"><i class="fas fa-lock" style="font-size: 0.7rem; margin-right:5px; color:#27c93f;"></i> secure://jays-network/profile</div>
                </div>
                <div class="browser-body">
                    <div id="browser-loader">
                        <i class="fas fa-database fa-spin fa-3x"></i>
                        <div class="scanning-text">ACCESSING ENCRYPTED PROFILE DATA...</div>
                    </div>
                    <div id="browser-content-container" style="display: none; opacity: 0;">
                        <h3 class="stack-title">ABOUT ME</h3>
                        <p class="bio-text">
                            I am an up-and-coming <span class="highlight">Full Stack programmer</span> and software engineer. 
                            I'm <span class="highlight">self-taught</span> and dedicated to building new projects with a strong passion and drive.
                            Currently architecting solutions for <span class="highlight">Custom Communications</span> and managing advanced Home Lab infrastructure.
                        </p>
                        
                        <div class="tech-stack">
                            <span class="stack-title">TECHNOLOGIES & TOOLS</span>
                            <div class="icons-row">
                                <i class="devicon-python-plain colored" title="Python"></i>
                                <i class="devicon-typescript-plain colored" title="TypeScript"></i>
                                <i class="devicon-javascript-plain colored" title="JavaScript"></i>
                                <i class="devicon-csharp-plain colored" title="C#"></i>
                                <i class="devicon-kotlin-plain colored" title="Kotlin"></i>
                                <i class="devicon-postgresql-plain colored" title="PostgreSQL"></i>
                                <i class="devicon-debian-plain colored" title="Debian"></i>
                                <i class="devicon-yaml-plain colored" title="YAML"></i>
                                <i class="fas fa-code" title="Replit/IDE" style="color: #F26207;"></i>
                            </div>
                        </div>

                        <div class="connect-section">
                            <span class="stack-title">CONNECT WITH ME</span>
                            <div class="action-area">
                                <p class="terminal-text">ESTABLISH COMMUNICATION:</p>
                                <a href="{% url 'contact' %}" class="uplink-btn">
                                    <span class="btn-text">INITIALIZE UPLINK</span>
                                    <span class="btn-glitch" aria-hidden="true">INITIALIZE UPLINK</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="scroll-hidden" id="terminal-window">
                {% include 'core/includes/status_terminal.html' %}
            </div>

        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        function updateDashboard() {
            const cpuNodes = document.querySelectorAll('.live-cpu');
            const memNodes = document.querySelectorAll('.live-mem');
            const bars = document.querySelectorAll('.animate-cpu');
            const memBars = document.querySelectorAll('.animate-mem');

            // Update CPU (Random between 2% and 15%)
            cpuNodes.forEach((node, index) => {
                const usage = Math.floor(Math.random() * (15 - 2 + 1) + 2);
                node.innerText = usage + "%";
                if(bars[index]) bars[index].style.width = usage + "%";
            });

            // Update RAM (Base values +/- 2%)
            memNodes.forEach((node, index) => {
                const base = index === 0 ? 73 : 75; // Mac vs Acer base load
                const variance = Math.floor(Math.random() * 5) - 2; 
                const final = base + variance;
                
                node.innerText = final + "%";
                if(memBars[index]) memBars[index].style.width = final + "%";
            });
        }
        setInterval(updateDashboard, 3000);
    });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // --- CONFIGURATION ---
        // These values are injected by Django from your .env file
        const SUPABASE_URL = "{{ supabase_url }}";
        const SUPABASE_KEY = "{{ supabase_key }}";
        
        // Check if keys are loaded
        if (!SUPABASE_URL || !SUPABASE_KEY || SUPABASE_URL === "None") {
            console.warn("Supabase Keys missing. Check .env and views.py");
            document.getElementById('attack-list').innerHTML = '<p style="color: #555; padding: 10px;">>> UPLINK OFFLINE (MISSING_KEYS)</p>';
        } else {
            // Initialize
            const { createClient } = supabase;
            const client = createClient(SUPABASE_URL, SUPABASE_KEY);

            async function fetchLatestBlocks() {
                const { data, error } = await client
                    .from('security_blocks')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(10);

                if (data) {
                    const container = document.getElementById('attack-list');
                    
                    if (data.length === 0) {
                        container.innerHTML = '<p style="color: #555; padding: 10px;">>> SYSTEM SECURE. NO ACTIVE THREATS.</p>';
                        return;
                    }

                    container.innerHTML = data.map(block => {
                        const time = new Date(block.created_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
                        return `
                            <div class="threat-entry">
                                <span class="log-time">[${time}]</span>
                                <span class="log-action">BLOCKED</span>
                                <span class="log-ip">${block.country_code} :: ${block.attacker_ip}</span>
                                <span class="log-target">TARGET: ${block.target_path}</span>
                            </div>
                        `;
                    }).join('');
                } else if (error) {
                    console.error("Supabase Error:", error);
                }
            }

            // Run immediately and then every 5 seconds
            fetchLatestBlocks();
            setInterval(fetchLatestBlocks, 5000);
        }
    </script>

{% endblock %}